<div class="bg-gray-800/50 rounded-lg p-6 flex flex-col h-full border border-gray-700">
  <h2 class="text-2xl font-bold text-white mb-1">Análisis de Trade con IA</h2>
  <p class="text-sm text-gray-400 mb-6">Activo: <span class="font-semibold text-cyan-400">{{ asset() }}</span> | Temporalidad: <span class="font-semibold text-cyan-400">{{ timeframe() }}</span></p>

  <div class="flex-grow flex flex-col overflow-y-auto pr-2">
    @if (isLoading()) {
      <div class="flex-grow flex flex-col items-center justify-center space-y-4">
        <div class="animate-spin rounded-full h-16 w-16 border-b-2 border-cyan-400"></div>
        <p class="text-gray-400 animate-pulse">Analizando mercado y sentimiento web...</p>
      </div>
    } @else if (error()) {
      <div class="flex-grow flex flex-col items-center justify-center bg-red-900/20 text-red-400 rounded-lg p-4">
        <h3 class="font-bold">Análisis Fallido</h3>
        <p class="text-center text-sm">{{ error() }}</p>
      </div>
    } @else if (analysis(); as result) {
      <div class="flex-grow space-y-6 animate-fade-in">
        <!-- Recommendation -->
        <div class="p-4 rounded-lg" [class]="getRecommendationClasses(result.recommendation).bg">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-sm" [class]="getRecommendationClasses(result.recommendation).text">Recomendación</p>
              <p class="text-2xl font-bold" [class]="getRecommendationClasses(result.recommendation).text">{{ recommendationTranslations[result.recommendation] }}</p>
            </div>
            <div class="flex items-center space-x-2">
              <svg class="h-8 w-8" [class]="getRecommendationClasses(result.recommendation).text" fill="currentColor" viewBox="0 0 24 24">
                <path [attr.d]="getRecommendationClasses(result.recommendation).iconPath"></path>
              </svg>
              <p class="text-3xl font-light text-gray-300">{{ result.confidence }}<span class="text-lg">%</span></p>
            </div>
          </div>
        </div>
        <!-- Summary -->
        <div>
          <h3 class="font-semibold text-lg text-white mb-2">Resumen</h3>
          <p class="text-gray-400 text-sm leading-relaxed">{{ result.summary }}</p>
        </div>
        <!-- Key Factors -->
        <div>
          <h3 class="font-semibold text-lg text-white mb-3">Factores Clave</h3>
          <div class="space-y-4">
            <div class="bg-gray-900/50 p-3 rounded-md border-l-4 border-blue-500">
              <h4 class="font-bold text-blue-400">Análisis Técnico</h4>
              <p class="text-gray-400 text-sm mt-1">{{ result.keyFactors.technical }}</p>
            </div>
            <div class="bg-gray-900/50 p-3 rounded-md border-l-4 border-purple-500">
              <h4 class="font-bold text-purple-400">Análisis de Sentimiento</h4>
              <p class="text-gray-400 text-sm mt-1">{{ result.keyFactors.sentiment }}</p>
            </div>
          </div>
        </div>
         <!-- Live Sentiment -->
        @if (result.liveSentiment?.sources.length) {
          <div>
            <h3 class="font-semibold text-lg text-white mb-3">Sentimiento en Tiempo Real (Web)</h3>
            <div class="bg-gray-900/50 p-3 rounded-md border-l-4 border-teal-500">
              <p class="text-gray-400 text-sm mb-3 italic">"{{ result.liveSentiment.summary }}"</p>
              <h4 class="font-bold text-teal-400 text-xs uppercase tracking-wider mb-2">Fuentes</h4>
              <ul class="space-y-2">
                @for (source of result.liveSentiment.sources; track source.uri) {
                  <li class="flex items-start">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2 mt-0.5 text-gray-500 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1" />
                    </svg>
                    <a [href]="source.uri" target="_blank" rel="noopener noreferrer" class="text-sm text-cyan-400 hover:text-cyan-300 hover:underline break-all">
                      {{ source.title }}
                    </a>
                  </li>
                }
              </ul>
            </div>
          </div>
        }
      </div>
    } @else {
      <div class="flex-grow flex flex-col items-center justify-center text-center text-gray-500 border-2 border-dashed border-gray-700 rounded-lg p-4">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mb-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
        </svg>
        <p>Haz clic en "Analizar Trade" para obtener un análisis con IA para el activo y temporalidad seleccionados.</p>
      </div>
    }
  </div>

  <button (click)="getAnalysis()" [disabled]="isLoading()" class="mt-6 w-full bg-cyan-600 hover:bg-cyan-700 disabled:bg-gray-600 disabled:cursor-not-allowed text-white font-bold py-3 px-4 rounded-lg transition-colors duration-200 flex items-center justify-center flex-shrink-0">
    @if (isLoading()) {
      <div class="animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-3"></div>
      <span>Analizando...</span>
    } @else {
      <span>Analizar Trade</span>
    }
  </button>
</div>